# 面向对象

## 1. 什么是面向对象

* 1）**什么是面向对象编程？**

面向对象编程是一种编程范式或编程风格。

它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石。

* 2）**什么是面向对象编程语言？**

面向对象编程语言是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面向对

象编程四大特性（封装、抽象、继承、多态）的编程语言。

* 3）**如何判定一个编程语言是否是面向对象编程语言？**

如果按照严格的的定义，需要有现成的语法支持类、对象、四大特性才能叫作面向对象编程语言。

如果放宽要求的话，只要某种编程语言支持类、对象语法机制，那基本上就可以说这种编程语言是面向对象编程语言了，不一定非得要求具有所有的四大特性。

* 4）**面向对象编程和面向对象编程语言之间有何关系？**

面向对象编程一般使用面向对象编程语言来进行，但是，不用面向对象编程语言，我们照样可以进行面向对象编程。反过来讲，即便我们使用面向对象编程语言，写出来的代码也不一定是面向对象编程风格的，也有可能是面向过程编程风格的。

* 5）**什么是面向对象分析和面向对象设计？**

简单点讲，面向对象分析就是要搞清楚做什么，面向对象设计就是要搞清楚怎么做。

两个阶段最终的产出是类的设计，包括程序被拆解为哪些类，每个类有哪些属性方法、类与类之间如何交互等等。



## 2. 四大特性

### 1. 封装 Encapsulation

封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接口，授权外部仅能通过类提供的方式（或者叫函数）来访问内部信息或者数据。

**意义**

类仅仅通过有限的方法暴露必要的操作，也能提高类的易用性、可读性、维护性。



### 2. 抽象 Abstraction

抽象讲的是如何隐藏方法的具体实现，让调用者只需要关心方法提供了哪些功能，并不需要知道这些功能是如何实现的。

**意义**

实际上，如果上升一个思考层面的话，抽象及其前面讲到的封装都是人类处理复杂性的有效手段。

抽象作为一种只关注功能点不关注实现的设计思路，正好帮我们的大脑过滤掉许多非必要的信息。

除此之外，抽象作为一个非常宽泛的设计思想，在代码设计中，起到非常重要的指导作用。很多设计原则都体现了抽象这种设计思想，比如基于接口而非实现编程、开闭原则（对扩展开放、对修改关闭）、代码解耦（降低代码的耦合性）等。



### 3. 继承 Inheritance

继承是用来表示类之间的is-a 关系，比如猫是一种哺乳动物。从继承关系上来讲，继承可以分为两种模式，单继承和多继承。

单继承表示一个子类只继承一个父类，多继承表示一个子类可以继承多个父类，比如猫既是哺乳动物，又是爬行动物。

**意义**

继承最大的一个好处就是代码复用，不过，这一点也并不是继承所独有的，我们也可以通过其他方式来解决这个代码复用的问题，比如利用组合关系而不是继承关系。



> 不过，过度使用继承，继承层次过深过复杂，就会导致代码可读性、可维护性变差。为了了解一个类的功能，我们不仅需要查看这个类的代码，还需要按照继承关系一层一层地往上查看“父类、父类的父类……”的代码。还有，子类和父类高度耦合，修改父类的代码，会直接影响到子类。

所以，继承这个特性也是一个非常有争议的特性。很多人觉得继承是一种反模式。我们应该尽量少用，甚至不用。关于这个问题，在后面讲到**多用组合少用继承**这种设计思想的时候，我会非常详细地再讲解，这里暂时就不展开讲解了。



### 4. 多态 Polymorphism

多态是指，子类可以替换父类，在实际的代码运行过程中，调用子类的方法实现。

除了利用`继承加方法重写`这种实现方式之外，我们还有其他两种比较常见的的实现方式，一个是利用`接口类语法`，另一个是利用 `duck-typing 语法`。



**意义**

多态特性能提高代码的可扩展性和复用性。



### 5. 小结

**1. 关于封装特性**

封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接口，授权外部仅能通过类

提供的方式来访问内部信息或者数据。它需要编程语言提供权限访问控制语法来支持，例如

Java 中的 private、protected、public 关键字。封装特性存在的意义，

一方面是保护数据不被随意修改，提高代码的可维护性；

另一方面是仅暴露有限的必要接口，提高类的易用性。

**2. 关于抽象特性**

封装主要讲如何隐藏信息、保护数据，那抽象就是讲如何隐藏方法的具体实现，让使用者只

需要关心方法提供了哪些功能，不需要知道这些功能是如何实现的。抽象可以通过接口类或

者抽象类来实现，但也并不需要特殊的语法机制来支持。抽象存在的意义，

一方面是提高代码的可扩展性、维护性，修改实现不需要改变定义，减少代码的改动范围；

另一方面，它也是处理复杂系统的有效手段，能有效地过滤掉不必要关注的信息。

**3. 关于继承特性**继承是用来表示类之间的 is-a 关系，分为两种模式：单继承和多继承。

单继承表示一个子类只继承一个父类，多继承表示一个子类可以继承多个父类。为了实现继承这个特性，编程语言需要提供特殊的语法机制来支持。继承主要是用来解决代码复用的问题。

**4. 关于多态特性**

多态是指子类可以替换父类，在实际的代码运行过程中，调用子类的方法实现。多态这种特

性也需要编程语言提供特殊的语法机制来实现，比如继承、接口类、duck-typing。多态可

以提高代码的扩展性和复用性，是很多设计模式、设计原则、编程技巧的代码实现基础。



## 3. 面向对象与面向过程

### 1. 概述

* 1）什么是面向过程编程与面向过程编程语言？

* 2）面向对象编程相比面向过程编程有哪些优势？

* 3）为什么说面向对象编程语言比面向过程编程语言更高级？

* 4）有哪些看似是面向对象实际是面向过程风格的代码？

* 5）在面向对象编程中，为什么容易写出面向过程风格的代码？

* 6）面向过程编程和面向过程编程语言就真的无用武之地了吗？



面向对象

`面向对象编程`是一种编程范式或编程风格。它以类或对象作为组织代码的基本单元，并

将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石 。

`面向对象编程语言`是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面

向对象编程四大特性（封装、抽象、继承、多态）的编程语言。

面向过程

`面向过程编程`也是一种编程范式或编程风格。它以过程（可以为理解方法、函数、操作）作为组织代码的基本单元，以数据（可以理解为成员变量、属性）与方法相分离为最主要的特点。面向过程风格是一种流程化的编程风格，通过拼接一组顺序执行的方法来操作数据完成一项功能。

`面向过程编程语言首先是`一种编程语言。它最大的特点是不支持类和对象两个语法概念，不支持丰富的面向对象编程特性（比如继承、多态、封装），仅支持面向过程编程

### 2. 优势

面向过程和面向对象最基本的区别就是，代码的组织方式不同。

面向过程风格的代码被组织成了一组方法集合及其数据结构（struct User），方法和数据结构的定义是分开的。面向对象风格的代码被组织成一组类，方法和数据结构被绑定一起，定义在类中。

* 1）**OOP 更加能够应对大规模复杂程序的开发**

对于大规模复杂程序的开发来说，整个程序的处理流程错综复杂，并非只有一条主线。如果把整个程序的处理流程画出来的话，会是一个网状结构。如果我们再用面向过程编程这种流程化、线性的思维方式，去翻译这个网状结构，去思考如何把程序拆解为一组顺序执行的方法，就会比较吃力。

> 实际上，利用面向过程的编程语言照样可以写出面向对象风格的代码，只不过可能会比用面向对象编程语言来写面向对象风格的代码，付出的代价要高一些。
>
> 而且面向对象编程本身提供了类的概念，强制你做这件事情，而面向过程编程并不强求。



* 2）**OOP 风格的代码更易复用、易扩展、易维护**

面向对象编程提供的封装特性更有利于提高代码的易维护性。

抽象特性则提高了可扩展性。

继承、多态特性提高了代码的复用性。



* 3） **OOP 语言更加人性化、更加高级、更加智能**

人类最开始跟机器打交道是通过 0、1 这样的二进制指令，然后是汇编语言，再之后才出现了高级编程语言。从指令到汇编再到面向过程编程语言，跟机器打交道的方式在不停地演进，从中我们很容易发现这样一条规律，那就是编程语言越来越人性化、智能。

面向对象编程语言比起面向过程编程语言，更加人性化、更加高级、更加智能。



## 4. 看似面向对象，实则面向过程？

### 1. 问题

* 1）**滥用 getter、setter 方法**

自动为所有字段生成 getter、setter 方法。

违反了封装特性，将面向对象变成了面向过程。

> 封装特性定义为：通过访问权限控制，隐藏内部数据，外部仅能通过类提供的有限的接口访问、修改内部数据。
>
> 所以，暴露不应该暴露的 setter 方法，明显违反了面向对象的封装特性。数据没有访问权限控制，任何代码都可以随意修改它，代码就退化成了面向过程编程风格的了



* 2）**滥用全局变量和全局方法**

静态方法将方法与数据分离，破坏了封装特性，是典型的面向过程风格。

也不推荐将所有全局变量、工具方法放在一个类，推荐拆分为多个小类。



* 3）**定义数据和方法分离的类**

我们再来看最后一种面向对象编程过程中，常见的面向过程风格的代码。那就是，数据定义在一个类中，方法定义在另一个类中。

Web 开发的 MVC 三层架构中，经常出现这样的情况。

 VO（View Object）、BO（Business Object）、Entity 中只会定义数据，不会定义方法，所有操作这些数据的业务逻辑都定义在对应的 Controller 类、Service 类、Repository 类中，这就是典型的面向过程的编程风格。

实际上，这种开发模式叫作基于贫血模型的开发模式，也是我们现在非常常用的一种 Web项目的开发模式。看到这里，你内心里应该有很多疑惑吧？既然这种开发模式明显违背面向对象的编程风格，为什么大部分 Web 项目都是基于这种开发模式来开发呢？

> TODO

### 2. 原因

**在面向对象编程中，为什么容易写出面向过程风格的代码？**

面向过程编程风格恰恰符合人的这种流程化思维方式（先做什么，再做什么，最后做什么）。

而面向对象编程风格正好相反。它是一种自底向上的思考方式。

它不是先去按照执行流程来分解任务，而是将任务翻译成一个一个的小的模块（也就是类），设计类之间的交互，最后按照流程将类组装起来，完成整个任务。这样的思考路径比较适合复杂程序的开发，但并不是特别符合人类的思考习惯。

**面向过程编程及面向过程编程语言就真的无用武之地了吗？**

以算法为主，数据为辅，那脚本式的面向过程的编程风格就更适合一些

实际上，面向过程编程是面向对象编程的基础，面向对象编程离不开基础的面向过程编程。类中每个方法的实现逻辑，不就是面向过程风格的代码吗？

不管使用面向过程还是面向对象哪种风格来写代码，我们最终的目的还是写出易维护、易读、易复用、易扩展的高质量代码。



## 5. 接口和抽象类

抽象类实际上就是类，只不过是一种特殊的类，这种类不能被实例化为对象，只能被子类继承。我们知道，继承关系是一种 is-a 的关系，那抽象类既然属于类，也表示一种 is-a 的关系。

相对于抽象类的 is-a 关系来说，接口表示一种 has-a 关系，表示具有某些功能。对于接口，有一个更加形象的叫法，那就是协议（contract）。

**抽象与接口的意义**

抽象类可以是代码复用，虽然继承也可以实现，但是却没有抽象类这么优雅。

**抽象类更多的是为了代码复用，而接口就更侧重于解耦。**接口是对行为的一种抽象，相当于一组协议或者契约，你可以联想类比一下 API 接口。调用者只需要关注抽象的接口，不需要了解具体的实现，具体的实现代码对调用者透明。接口实现了约定和实现相分离，可以降低代码间的耦合性，提高代码的可扩展性。

实际上，接口是一个比抽象类应用更加广泛、更加重要的知识点。比如，我们经常提到的“基于接口而非实现编程”，就是一条几乎天天会用到，并且能极大地提高代码的灵活性、扩展性的设计思想。

**什么时候用接口，什么时候用抽象类？**

实际上，判断的标准很简单。如果我们要表示一种 is-a 的关系，并且是为了解决代码复用的问题，我们就用抽象类；如果我们要表示 一种 has-a 关系，并且是为了解决抽象而非代码复用的问题，那我们就可以使用接口。从类的继承层次上来看，抽象类是一种自下而上的设计思路，先有子类的代码重复，然后再抽象成上层的父类（也就是抽象类）。而接口正好相反，它是一种自上而下的设计思路。我们在编程的时候，一般都是先设计接口，再去考虑具体的实现。



## 6. 面向接口编程

实际上，**基于接口而非实现编程**这条原则的另一个表述方式，是**基于抽象而非实现编程**。后者的表述方式其实更能体现这条原则的设计初衷。

**越抽象、越顶层、越脱离具体某一实现的设计，越能提高代码的灵活性，越能应对未来的需求变化。好的代码设计，不仅能应对当下的需求，而且在将来需求发生变化的时候，仍然能够在不破坏原有代码设计的情况下灵活应对**



要遵从`基于接口而非实现编程`的原则，具体来讲，我们需要做到下面这 3 点。

* 1）**函数的命名不能暴露任何实现细节**。比如，前面上传图片叫 `uploadToAliyun()` 就不符合要求，应该改为去掉 aliyun 这样的字眼（万一以后要传到私有云呢），改为更加抽象的命名方式，比如：upload()。

* 2）**封装具体的实现细节**。比如，跟阿里云相关的特殊上传（或下载）流程不应该暴露给调用者。我们对上传（或下载）流程进行封装，对外提供一个包裹所有上传（或下载）细节的方法，给调用者使用。

* 3）**为实现类定义抽象的接口**。具体的实现类都依赖统一的接口定义，遵从一致的上传功能协议。使用者依赖接口，而不是具体的实现类来编程。



**是否需要为每个类定义接口？**

这条原则的设计初衷是，将接口和实现相分离，封装不稳定的实现，暴露稳定的接口。

上游系统面向接口而非实现编程，不依赖不稳定的实现细节，这样当实现发生变化的时候，上游系统的代码基本上不需要做改动，以此来降低代码间的耦合性，提高代码的扩展性。

> 如果在我们的业务场景中，某个功能只有一种实现方式，未来也不可能被其他实现方式替换，那我们就没有必要为其设计接口，也没有必要基于接口编程，直接使用实现类就可以了。



## 7. 为何说要多用组合少用继承

* 1）**为什么不推荐使用继承？**

继承最大的问题就在于：继承层次过深、继承关系过于复杂会影响到代码的可读性和可维护性。



* 2）**组合相比继承有哪些优势？**

组合可以实现继承的作用，且不会影响到可读性和可维护性。

我们知道继承主要有三个作用：表示 is-a 关系，支持多态特性，代码复用。

而这三个作用都可以通过其他技术手段来达成。

* 比如 is-a 关系，我们可以通过组合和接口的 has-a 关系来替代；

* 多态特性我们可以利用接口来实现；

* 代码复用我们可以通过组合和委托来实现。

所以，从理论上讲，通过组合、接口、委托三个技术手段，我们完全可以替换掉继承，在项目中不用或者少用继承关系，特别是一些复杂的继承关系。



* 3）**如何判断该用组合还是继承？**

