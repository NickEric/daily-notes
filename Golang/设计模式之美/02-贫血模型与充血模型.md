# 贫血模型与充血模型

## 1. 业务开发常用的基于贫血模型的 MVC 架构违背 OOP 吗？

虽然这种开发模式已经成为标准的 Web 项目的开发模式，但它却违反了面向对象编程风格，是一种彻彻底底的面向过程的编程风格，因此而被有些人称为反模式（anti-pattern）。特别是**领域驱动设计**（Domain Driven Design，简称 DDD）盛行之后，这种基于贫血模型的传统的开发模式就更加被人诟病。而基于充血模型的 DDD 开发模式越来越被人提倡。

* 1）什么是贫血模型？什么是充血模型？

* 2）为什么说基于贫血模型的传统开发模式违反 OOP?

* 3）基于贫血模型的传统开发模式既然违反 OOP，那又为什么如此流行？

* 4）什么情况下我们应该考虑使用基于充血模型的 DDD 开发模式？



**1）什么是基于贫血模型的传统开发模式？**

比如，现在很多 Web 或者 App 项目都是前后端分离的，后端负责暴露接口给前端调用。

这种情况下，我们一般就将后端项目分为 Repository 层、Service 层、Controller 层。

其中，Repository 层负责数据访问，Service 层负责业务逻辑，Controller 层负责暴露接口。

当然，这只是其中一种分层和命名方式。不同的项目、不同的团队，可能会对此有所调整。不过，万变不离其宗，只要是依赖数据库开发的 Web 项目，基本的分层思路都大差不差。

一般情况下，对于一个用户模块，可能 UserEntity 和 UserRepository 组成了数据访问层，UserBo 和 UserService 组成了业务逻辑层，UserVo和 UserController 在这里属于接口层。

**像 UserEntity 这种只包含数据，不包含业务逻辑的类，就叫作`贫血模型`（Anemic Domain Model）**。

> 这种贫血模型将数据与操作分离，破坏了面向对象的封装特性，是一种典型的面向过程的编程风格。



**2）什么是基于充血模型的 DDD 开发模式?**

领域驱动设计，即 DDD，主要是用来指导如何解耦业务系统，划分业务模块，定义业务领域模型及其交互。

实际上，基于充血模型的 DDD 开发模式实现的代码，也是按照 MVC 三层架构分层的。

Controller 层还是负责暴露接口，Repository 层还是负责数据存取，Service 层负责核心业务逻辑。它跟基于贫血模型的传统开发模式的区别主要在 Service 层。

在基于贫血模型的传统开发模式中，Service 层包含 Service 类和 BO 类两部分，BO 是贫血模型，只包含数据，不包含具体的业务逻辑。业务逻辑集中在 Service 类中。

在基于充血模型的 DDD 开发模式中，Service 层包含 Service 类和 Domain 类两部分。Domain 就相当于贫血模型中的 BO。

不过，Domain 与 BO 的区别在于它是基于充血模型开发的，既包含数据，也包含业务逻辑。而Service 类变得非常单薄。

**总结**一下的话就是，基于贫血模型的传统的开发模式，重 Service 轻 BO；基于充血模型的 DDD 开发模式，轻 Service 重Domain



**3）为什么基于贫血模型的传统开发模式如此受欢迎？**

* 1）大部分情况下，我们开发的系统**业务比较简单**，我们根本不需要动脑子精心设计充血模型，贫血模型就足以应付这种简单业务的开发工作，因此就算设计出来的领域模型也会比较单薄，跟贫血模型差不多，没有太大意义。

* 2）**充血模型的设计要比贫血模型更加有难度**。因为充血模型是一种面向对象的编程风格。我们从一开始就要设计好针对数据要暴露哪些操作，定义哪些业务逻辑。而不是像贫血模型样，我们只需要定义数据，之后有什么功能开发需求，我们就在 Service 层定义什么操作，不需要事先做太多设计。

* 3）**思维已固化，转型有成本**。基于贫血模型的传统开发模式经历了这么多年，已经深得人心、习以为常。如果转向用充血模型、领域驱动设计，那势必有一定的学习成本、转型成本。





**4）什么项目应该考虑使用基于充血模型的 DDD 开发模式？**

基于充血模型的 DDD 开发模式，更适合业务复杂的系统开发。比如，包含各种利息计算模型、还款模型等复杂业务的金融系统。

> 越复杂的系统，对代码的复用性、易维护性要求就越高，我们就越应该花更多的时间和精力在前期设计上。而基于充血模型的 DDD 开发模式，正好需要我们前期做大量的业务调研、领域模型设计，所以它更加适合这种复杂系统的开发。