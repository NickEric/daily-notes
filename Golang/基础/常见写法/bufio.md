# bufio 包



### 问题1

**`bufio.Reader`类型值中的缓冲区起着怎样的作用？**



`bufio.Reader`类型的值（以下简称`Reader`值）内的缓冲区其实就是一个数据存储中介，它介于底层读取器与读取方法及其调用方之间。所谓的底层读取器，就是在初始化此类值的时候传入的`io.Reader`类型的参数值。

`Reader`值的读取方法一般都会先从其所属值的缓冲区中读取数据。同时，在必要的时候，它们还会预先从底层读取器那里读出一部分数据，并暂存于缓冲区之中以备后用。

有这样一个缓冲区的好处是，可以在大多数的时候降低读取方法的执行时间。虽然读取方法有时还要负责填充缓冲区，但从总体来看，读取方法的平均执行时间一般都会因此有大幅度的缩短。

**解析**

```go
type Reader struct {
	buf          []byte
	rd           io.Reader 
	r, w         int      
	err          error
	lastByte     int
	lastRuneSize int 
}
```

* 1) `buf`：`[]byte`类型的字段，即字节切片，代表缓冲区。虽然它是切片类型的，但是其长度却会在初始化的时候指定，并在之后保持不变。
* 2) `rd`：`io.Reader`类型的字段，代表底层读取器。缓冲区中的数据就是从这里拷贝来的。
* 3) `r`：`int`类型的字段，代表对缓冲区进行下一次读取时的开始索引。我们可以称它为已读计数。
* 4) `w`：`int`类型的字段，代表对缓冲区进行下一次写入时的开始索引。我们可以称之为已写计数。
* 5) `err`：`error`类型的字段。它的值用于表示在从底层读取器获得数据时发生的错误。这里的值在被读取或忽略之后，该字段会被置为`nil`。
* 6) `lastByte`：`int`类型的字段，用于记录缓冲区中最后一个被读取的字节。读回退时会用到它的值。
* 7) `lastRuneSize`：`int`类型的字段，用于记录缓冲区中最后一个被读取的 Unicode 字符所占用的字节数。读回退的时候会用到它的值。这个字段只会在其所属值的`ReadRune`方法中才会被赋予有意义的值。在其他情况下，它都会被置为`-1`。





### 问题2

**`bufio.Writer`类型值中缓冲的数据什么时候会被写到它的底层写入器？**

我们先来看一下`bufio.Writer`类型都有哪些字段：

* 1）`err`：`error`类型的字段。它的值用于表示在向底层写入器写数据时发生的错误。
* 2）`buf`：`[]byte`类型的字段，代表缓冲区。在初始化之后，它的长度会保持不变。
* 3）`n`：`int`类型的字段，代表对缓冲区进行下一次写入时的开始索引。我们可以称之为已写计数。
* 4）`wr`：`io.Writer`类型的字段，代表底层写入器。





### 问题3

**`bufio.Reader`类型读取方法有哪些不同？**

`bufio.Reader`类型拥有很多用于读取数据的指针方法，**这里面有 4 个方法可以作为不同读取流程的代表，它们是：`Peek`、`Read`、`ReadSlice`和`ReadBytes`。**



比较特殊的就是 `Peek`方法。读取并返回其缓冲区中的`n`个未读字节，并且它会从已读计数代表的索引位置开始读。**即使它读取了缓冲区中的数据，也不会更改已读计数的值。**