# MySQL 数据类型

## 1. 概述

MySQL 中数据类型可以分为以下几类：

* 1）数值
* 2）字符串
* 3）时态
* 4）空间
* 5）NULL



## 2. 数值

### 1. 整形

也就是 INT，更新大小不同又细分为如下几种：

| 数据类型  | 大小（字节） | 范围（有符号）                           | 范围（无符号）         |
| --------- | ------------ | ---------------------------------------- | ---------------------- |
| TINYINT   | 1            | -128~127                                 | 0~255                  |
| SMALLINT  | 2            | -32768~32767                             | 0~65535                |
| MEDIUMINT | 3            | -8388608~8388607                         | 0~16777215             |
| INT       | 4            | -2147483648~2147483647                   | 0~4294967295           |
| BIGINT    | 8            | -9223372036854775808~9223372036854775807 | 0~18446744073709551616 |



**整型（N）形式**

在开发中，我们会碰到有些定义整型的写法是int(11)，int(N)我们只需要记住两点：

- 无论N等于多少，int 永远占 4 个字节
- **N表示的是显示宽度，不足的用0补足，超过长度的不会被截字，也是直接显示整个数字，但这要整型设置了unsigned zerofill才有效**

**MySQL中整型默认是带符号的**

### 2. 浮点型

| **数据类型** | **字节数** | **备注**     |
| ------------ | ---------- | ------------ |
| FLOAT        | 4          | 单精度浮点型 |
| DOUBLE       | 8          | 双精度浮点型 |

float(M,D)、double(M、D)的用法规则：

- D表示浮点型数据小数点之后的精度，假如超过D位则四舍五入，即1.233四舍五入为1.23，1.237四舍五入为1.24
- M表示浮点型数据总共的位数，M=5,D=2则表示总共支持五位，即小数点前只支持三位数，

当我们不指定M、D的时候，会按照实际的精度来处理。

### 3. 定点型

| **数据类型** | **字节数**                               | **备注**   |
| ------------ | ---------------------------------------- | ---------- |
| DECIMAL      | 对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2 | 精确小数值 |

最后讲一下decimal和float/double的区别，主要体现在两点上：

- float/double在db中存储的是近似值，而decimal则是以字符串形式进行保存的
- decimal(M,D)的规则和float/double相同，但区别在float/double在不指定M、D时默认按照实际精度来处理而decimal在不指定M、D时默认为decimal(10, 0)

## 2. 字符

### 1.char、varchar
| 数据类型 | 大小（字节） | 备注     |
| ------------ | ---------- | ------------ |
| CHAR        | 0-255         | 定长字符串 |
| VARCHAR       | 	0-65535          | 变长字符串 |

> char(n) 和 varchar(n) 中括号中 n 代表字符的个数，并不代表字节个数，比如 CHAR(30) 就可以存储 30 个字符。

关于char和varchar的对比：

* 1）char是固定长度字符串，其长度范围为0~255且与编码方式无关，无论字符实际长度是多少，都会按照指定长度存储，不够的用空格补足；varchar为可变长度字符串，在utf8编码的数据库中其长度范围为0~21844
* 2）char实际占用的字节数即存储的字符所占用的字节数，varchar实际占用的字节数为存储的字符+1或+2或+3
* 3）MySQL处理char类型数据时会将结尾的所有空格处理掉而varchar类型数据则不会

**varchar型数据占用空间大小及可容纳最大字符串限制探究**

**这部分和具体编码方式有关**，详情如下：

- MySQL要求一个**行**的定义长度不能超过 65535 即 64K
- 对于未指定 varchar 字段 not nul l的表，会有**1个字节**专门表示该字段是否为 null
- varchar(M)会有一个空间用于记录字符串长度
  - 当M范围为0<=M<=255时会专门有一个字节记录varchar型字符串长度
  - 当M>255时会专门有两个字节记录varchar型字符串的长度
  - 把这一点和上一点结合，那么65535个字节实际可用的为65535-3=65532个字节
- 不同编码方式，占用字节数也不同
  - 所有英文无论其编码方式，都占用1个字节，因此最大M=65532；
  - 对于gbk编码，一个汉字占两个字节，因此最大M=65532/2=32766；
  - 对于utf8编码，一个汉字占3个字节，因此最大M=65532/3=21844；
  - 对于utfmb4编码方式，1个字符最大可能占4个字节，那么varchar(M)，M最大为65532/4=16383

同样的，上面是一行中只有varchar型数据的情况，**如果存在其他列，比如同时存在int、double、char这些数据，需要把这些数据所占据的空间减去，才能计算varchar(M)型数据M最大等于多少**。



### 2. text、blob

至于text和blob，简单过一下就是**text存储的是字符串而blob存储的是二进制字符串**，简单说blob是用于存储例如图片、音视频这种文件的二进制数据的。


| 数据类型   | 大小（字节）           | 备注         |
| ---------- | ---------------------- | ------------ |
| TINYTEXT   | 0~255                  |              |
| TEXT       | 0-65 535               | 单精度浮点型 |
| MEDIUMTEXT | 0-16 777 215           |              |
| LONGTEXT   | 0-4 294 967 295（4GB） |              |
| TINYBLOB   | 0~255                  |              |
| BLOB       | 0-65 535               | 单精度浮点型 |
| MEDIUMBLOB | 0-16 777 215           |              |
| LONGBLOB   | 0-4 294 967 295（4GB） |              |

先说一下text，text和varchar是一组既有区别又有联系的数据类型，其联系在于**当varchar(M)的M大于某些数值时，varchar会自动转为text**：

- M>255时转为tinytext
- M>500时转为text
- M>20000时转为mediumtext

所以过大的内容varchar和text没有区别，同事varchar(M)和text的区别在于：

- 单行64K即65535字节的空间，varchar只能用63352/65533个字节，但是text可以65535个字节全部用起来
- text可以指定text(M)，但是M无论等于多少都没有影响
- text不允许有默认值，varchar允许有默认值

## 3. 日期类型

接着我们看一下MySQL中的日期类型，MySQL支持五种形式的日期类型：date、time、year、datetime、timestamp，用一张表格总结一下这五种日期类型：

| 数据类型  | 大小（字节） | 格式                | 备注                      |
| --------- | ------------ | ------------------- | ------------------------- |
| date      | 3            | yyyy-MM-dd          | 存储日期值                |
| time      | 3            | HH:mm:ss            | 存储时分秒                |
| year      | 1            | yyyy                | 存储年                    |
| datetime  | 8            | yyyy-MM-dd HH:mm:ss | 存储日期+时间             |
| timestamp | 4            | yyyy-MM-dd HH:mm:ss | 存储日期+时间，可作时间戳 |

MySQL的时间类型的知识点比较简单，这里重点关注一下datetime与timestamp两种类型的区别：

- 上面列了，datetime占8个字节，timestamp占4个字节
- 由于大小的区别，datetime与timestamp能存储的时间范围也不同，datetime的存储范围为1000-01-01 00:00:00——9999-12-31 23:59:59，timestamp存储的时间范围为19700101080001——20380119111407
- datetime默认值为空，当插入的值为null时，该列的值就是null；timestamp默认值不为空，当插入的值为null的时候，mysql会取当前时间
- datetime存储的时间与时区无关，timestamp存储的时间及显示的时间都依赖于当前时区

**如何选择**

* timestamp 记录经常变化的更新 / 创建 / 发布 / 日志时间 / 购买时间 / 登录时间 / 注册时间等，并且是近来的时间，够用，时区自动处理，比如说做海外购或者业务可能拓展到海外
* datetime 记录固定时间如服务器执行计划任务时间 / 健身锻炼计划时间等，在任何时区都是需要一个固定的时间要做某个事情。超出 timestamp 的时间，如果需要时区必须记得时区处理

https://learnku.com/laravel/t/2495/select-the-appropriate-mysql-date-time-type-to-store-your-time

## 4. 空间

这个一般用得不多。

  Geometry:可以存储所有的几何类型

  Point:简单点

  LINESTRING:简单线

  POLYGON:简单面

  MULTIPOINT：多点

  MULITILINESTRING:多线

  MUILITIPOLYGON：很多方面

  GEOMETRYCOLLECTION:任何几何集合

## 5. NULL

NULL 值为 MySQL 中的一个特殊值。

MySQL提供了三大运算符:

- **IS NULL:** 当列的值是 NULL,此运算符返回 true。
- **IS NOT NULL:** 当列的值不为 NULL, 运算符返回 true。
- **<=>:** 比较操作符（不同于 = 运算符），当比较的的两个值相等或者都为 NULL 时返回 true。

NULL与空值的区别：

- MySQL中，null是未知的，且占用空间的。null使得索引、索引统计和值都更加复杂，并且影响优化器的判断。
- 空值('')是不占用空间的，注意空值的''之间是没有空格。
- 在进行count()统计某列的记录数的时候，如果采用的 NULL 值，会被系统自动忽略掉，但是空值是会进行统计到其中的。
- 判断null使用is null或者is not null，但判断空字符使用 =''或者 <>''来进行处理。
- 对于timestamp数据类型，如果插入 NULL 值，则出现的值是当前系统时间。插入空值，则会出现'0000-00-00 00:00:00' 。
- 对于已经创建好的表，普通的列将 null修改为 not null带来的性能提升比较小，所以调优时没有必要特意一一查找并null修改 not null。
- 对于已经创建好的表，如果计划在列上创建索引，那么尽量修改为not null，并且使用0 或者一个特殊值或者空值''。

## 6. 其他

MySQL 从 5.7 版本开始也引入了 JSON 类型，使用起来和其他类型也没多大区别

```mysql
drop table if exists test_json;
CREATE TABLE test_json (
    id BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    content json
);

INSERT INTO test_json (content)
VALUES
 (
     '{"name": "17x", "blog": "https://www.lixueduan.com"}'
);
SELECT * FROM test_json;
```

