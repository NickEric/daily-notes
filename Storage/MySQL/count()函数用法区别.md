# count()函数用法区别

## 1. 概述

`count()` 是一个聚合函数，对于返回的结果集，一行行地判断，如果 count 函数的参数不是 NULL，累计值就加 1，否则不加。最后返回累计值。

所以，`count(*)`、`count(主键 id)` 和 `count(1) `都表示返回满足条件的结果集的总行数；

> count(1) 为 count(常量) 中的一种， count(2) count(999) 效果都是一样的

而 `count(字段)`，则表示返回满足条件的数据行里面，参数`字段`不为 NULL 的总个数。

## 2. 区别

至于分析性能差别的时候，你可以记住这么几个原则：

* server 层要什么就给什么；
* InnoDB 只给必要的值；
* 现在的优化器只优化了 `count(*) `的语义为`取行数`，其他“显而易见”的优化并没有做。



对于 `count(主键 id) `来说，InnoDB 引擎会遍历整张表，**把每一行的 id 值都取出来**，返回给 server 层。server 层拿到 id 后，判断不为空，就按行累加。

> **主键 id 列肯定是不能为空的**，所以 `count(主键 id) ` 就是返回该表的总行数。直接使用  `count(1)` 就能达到同样的效果且效率更高

对于 `count(1)` 来说，InnoDB 引擎**遍历整张表但不取值**。server 层对于返回的每一行，用 1 来填充，所以是不可能为空的，直接按行累加。

> count(常量) 不需要获取到每一行的值 所以很快

对于 `count(字段)` 来说:

* 如果这个“字段”是定义为 `not null` 的话，那么该列的值肯定不会是 null，所以就不需要判断值是否为 null 了。一行行地从记录里面读出这个字段，按行累加；
* 如果这个“字段”定义允许为 `null`，那么执行的时候，就需要把值取出来再判断一下，不是 null 才累加。也就是前面的第一条原则，server 层要什么字段，InnoDB 就返回什么字段。

但是` count(*) `是例外，并不会把全部字段取出来，而是**专门做了优化，不取值。**

> count(*) 肯定不是 null，按行累加。



## 3. 小结

所以结论是：按照效率排序的话，`count(字段)`<`count(主键 id)`<`count(1)`≈`count(*)`。

所以推荐使用 `count(*)`

